# mem

CLI tool for managing AI agent artifacts in git repositories.

## Overview

mem provides a structured way to store and manage artifacts generated by AI agents within your git workflow. It uses git worktrees to create an isolated storage environment that keeps agent-generated content separate from your main codebase while maintaining full version control.

## Features

- Git-based artifact storage using worktrees and orphan branches
- Branch-aware artifact organization (artifacts tracked per git branch)
- Multiple artifact categories: root, trace, tmp, ref
- Reference material management (clone GitHub repos, copy local files)
- Automatic .gitignore for temporary files
- Git integration (status, diff, push, pull)
- Nushell-based implementation

## Installation

### Using Nix

```bash
nix run github:palekiwi-labs/mem
```

## Directory Structure

```
.agents/
├── .gitignore           # Ignores */tmp/ and */ref/
├── <branch-name>/       # Per-branch directories
│   ├── plan.md          # Root-level artifacts
│   ├── trace/           # Commit-tied artifacts
│   │   └── <commit>/    # Specific commit hash
│   │       └── log.txt
│   ├── tmp/             # Temporary artifacts
│   │   └── <commit>/
│   │       └── cache.json
│   └── ref/             # Reference materials
│       └── hello-world/ # Cloned repos or copied files
```

**Root vs Trace Artifacts:**
- **Root files** (e.g., `.agents/dev/plan.md`): Long-lived artifacts that persist across commits
- **Trace files** (e.g., `.agents/dev/trace/abc123/log.txt`): Tied to specific commits, organized by commit hash

## Usage

### Initialize

Initialize mem in your git repository:

```bash
mem init
```

This creates:
- `.agents/` directory as a git worktree
- `mem` orphan branch
- Initial `.gitignore` in the worktree

### Add Artifacts

Create artifact files in various categories:

```bash
# Create file in root of current branch
mem add plan.md

# Create file with content
mem add note.txt "Important information"

# Create file in trace/ directory with current commit hash
mem add log.txt --trace

# Create file in tmp/ directory
mem add cache.json --tmp

# Create file in ref/ directory
mem add doc.md --ref

# Specify commit hash manually
mem add analysis.txt --trace --commit abc1234

# Overwrite existing file
mem add plan.md --force
```

### Manage References

Add reference materials for AI agents:

```bash
# Clone GitHub repository
mem ref add github:octocat/hello-world

# Clone specific branch
mem ref add github:octocat/hello-world/develop

# Clone at specific commit
mem ref add github:octocat/hello-world@abc1234

# Shallow clone
mem ref add github:octocat/hello-world --depth 1

# Copy local file or directory
mem ref add path:/etc/config.yaml
mem ref add path:~/Documents/api-docs/

# Overwrite existing reference
mem ref add github:octocat/hello-world --force
```

### List Artifacts

List tracked artifacts:

```bash
# List files for current branch
mem list

# List files for all branches
mem list --all

# List files with depth limit
mem list --depth 2

# Output in JSON format
mem list --json
```

### Cleanup

Remove temporary and reference files:

```bash
# Delete tmp/ and ref/ for current branch
mem prune

# Delete for all branches (with confirmation)
mem prune --all

# Skip confirmation
mem prune --force

# Delete for all branches, no confirmation
mem prune -af
```

### Git Operations

View and manage git status:

```bash
# Show git status of mem directory
mem status

# Show all changes
mem diff

# Show changes for specific file
mem diff spec.md

# Show changes for specific path
mem diff trace/abc123d/
```

Sync with remote:

```bash
# Push to origin/mem
mem push

# Push to specific remote
mem push --remote upstream

# Pull from origin/mem
mem pull

# Pull from specific remote
mem pull --remote upstream
```

### Version

```bash
mem --version
mem version
```

## How It Works

mem uses git worktrees to create an isolated environment for storing agent artifacts:

1. **Orphan Branch**: Creates a `mem` branch with no history
2. **Worktree Mount**: Mounts the orphan branch at `.agents/`
3. **Branch Isolation**: Artifacts are organized by git branch
4. **Git Tracking**: All artifacts are tracked via git, respecting .gitignore
5. **Remote Sync**: Push/pull operations sync the mem branch

## License

MIT

## Copyright

Copyright (c) 2026 Palekiwi Labs
